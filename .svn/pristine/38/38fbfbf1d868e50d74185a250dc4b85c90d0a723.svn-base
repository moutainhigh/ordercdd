"use strict";app.controller("auditEntityConfigModuleController",["$rootScope","$scope","$http","$stateParams",function(a,b,d,c){b.entity_key=c.entity_key;console.log("auditEntityConfigModuleController")}]);app.controller("auditEntityConfigActListController",["$rootScope","$scope","$http","$state","$stateParams","entity",function(a,c,f,d,e,b){c.entity_key=e.entity_key;c.acts=[];b.getList("/rest/"+c.entity_key+"Acts?size=10000").then(function(g){c.acts=g._embeddedItems});c.actEdit=function(g){d.go("auditEntityConfig.actEdit",{act_id:g},{reload:true})};c.actRole=function(g){d.go("auditEntityConfig.actRole",{act_id:g},{reload:true})}}]);app.controller("auditEntityConfigActFormController",["$rootScope","$scope","$http","$state","$stateParams","entity",function(a,c,f,d,e,b){c.entity_key=e.entity_key;c.act_id=e.act_id;c.act={};c.noticeRole=null;c.noticeDepartmenttype=null;c.allRoles=[];c.allDepartmenttypes=[];c.allActGroups=a.allEntitiesInfo[c.entity_key+"Act"].actGroup.values;c.getAllRoles=function(){b.getList("/rest/roles?size=10000").then(function(g){c.allRoles=g._embeddedItems;if(c.act_id){b.getDetail(c.act._links.noticeRole.href).then(function(h){c.noticeRole=b.getSelectedMyOwn(c.allRoles,h)})}})};c.getAllDepartmenttypes=function(){b.getList("/rest/departmenttypes?size=10000").then(function(g){c.allDepartmenttypes=g._embeddedItems;if(c.act_id){b.getDetail(c.act._links.noticeDepartmenttype.href).then(function(h){c.noticeDepartmenttype=b.getSelectedMyOwn(c.allDepartmenttypes,h);if(c.noticeDepartmenttype){c.setRoleFromDepartment(true)}})}else{c.setRoleFromDepartment(false)}})};if(c.act_id){b.getDetail("rest/"+c.entity_key+"Acts/"+c.act_id).then(function(g){c.act=g;c.getAllRoles();c.getAllDepartmenttypes()})}else{c.getAllRoles();c.getAllDepartmenttypes()}c.setRoleFromDepartment=function(g){if(c.noticeDepartmenttype&&g){b.getList(c.noticeDepartmenttype._links.roles.href).then(function(h){c.allRoles=h._embeddedItems;b.getDetail(c.act._links.noticeRole.href).then(function(i){c.noticeRole=b.getSelectedMyOwn(c.allRoles,i)})})}else{if(c.noticeDepartmenttype&&!g){b.getList(c.noticeDepartmenttype._links.roles.href).then(function(h){c.allRoles=h._embeddedItems})}}};c.save=function(){c.act.noticeRole=c.noticeRole?c.noticeRole._links.self.href:null;c.act.targetState=c.targetState?c.targetState._links.self.href:null;c.act.noticeDepartmenttype=c.noticeDepartmenttype?"/rest/departmenttypes/"+c.noticeDepartmenttype.id:null;if(c.act._links){f({url:c.act._links.self.href,method:"PATCH",data:c.act}).success(function(g){d.go("auditEntityConfig.acts",{},{reload:true});a.toasterSuccess("成功！","修改成功！")})}else{f.post("rest/"+c.entity_key+"Acts",c.act).success(function(g){d.go("auditEntityConfig.acts",{},{reload:true});a.toasterSuccess("成功！","新建成功！")})}}}]);app.controller("auditEntityConfigActRoleController",["$rootScope","$scope","$http","$stateParams","entity",function(a,c,e,d,b){c.entity_key=d.entity_key;c.act_id=d.act_id;c.allRoles=[];c.actRoles=[];b.getList("/rest/"+c.entity_key+"Acts/"+c.act_id+"/roles?size=10000").then(function(f){c.actRoles=f._embeddedItems;b.getList("/rest/roles?size=10000").then(function(g){c.allRoles=g._embeddedItems;angular.forEach(c.allRoles,function(i,h){i.isSelected=false;angular.forEach(c.actRoles,function(k,j){if(k.id===i.id){i.isSelected=true}})})})});c.changeActRole=function(f){if(f.isSelected){e({method:"PATCH",url:"/rest/"+c.entity_key+"Acts/"+c.act_id+"/roles",data:f._links.self.href,headers:{"Content-Type":"text/uri-list"}}).success(function(g){a.toasterSuccess("成功！","关联成功！")})}else{e({method:"DELETE",url:"/rest/"+c.entity_key+"Acts/"+c.act_id+"/roles/"+f.id}).success(function(g){a.toasterInfo("成功！","已取消关联！")})}}}]);app.controller("auditEntityConfigStateListController",["$rootScope","$scope","$http","$state","$stateParams","entity",function(a,c,f,d,e,b){c.entity_key=e.entity_key;c.states=[];b.getList("/rest/"+c.entity_key+"States?size=10000").then(function(g){c.states=g._embeddedItems});c.stateEdit=function(g){d.go("auditEntityConfig.stateEdit",{state_id:g},{reload:true})};c.stateAct=function(g){d.go("auditEntityConfig.stateAct",{state_id:g},{reload:true})}}]);app.controller("auditEntityConfigStateFormController",["$rootScope","$scope","$http","$state","$stateParams",function(a,b,e,c,d){b.entity_key=d.entity_key;b.state_id=d.state_id;b.state={};if(b.state_id){entity.getDetail("rest/"+b.entity_key+"States/"+b.state_id).then(function(f){b.state=f})}b.save=function(){if(b.state._links){e({url:b.state._links.self.href,method:"PATCH",data:b.state}).success(function(f){c.go("auditEntityConfig.states",{},{reload:true});a.toasterSuccess("成功！","修改成功！")}).error(function(f){})}else{e.post("rest/"+b.entity_key+"States",b.state).success(function(f){c.go("auditEntityConfig.states",{},{reload:true});a.toasterSuccess("成功！","新建成功！")})}}}]);app.controller("auditEntityConfigStateActController",["$rootScope","$scope","$http","$resource","$stateParams","entity",function(a,c,f,e,d,b){c.entity_key=d.entity_key;c.state_id=d.state_id;c.allActs=[];c.stateActs=[];b.getList("/rest/"+c.entity_key+"Acts?size=10000").then(function(g){c.allActs=g._embeddedItems;b.getList("/rest/"+c.entity_key+"States/"+c.state_id+"/acts?size=10000").then(function(h){c.stateActs=h._embeddedItems;angular.forEach(c.allActs,function(j,i){j.isSelected=false;angular.forEach(c.stateActs,function(l,k){if(l.id===j.id){j.isSelected=true}})})})});c.changeStateAct=function(g){console.log(g);if(g.isSelected){f({method:"PATCH",url:"/rest/"+c.entity_key+"States/"+c.state_id+"/acts",data:g._links.self.href,headers:{"Content-Type":"text/uri-list"}}).success(function(h){a.toasterSuccess("成功！","关联成功！")})}else{f({method:"DELETE",url:"/rest/"+c.entity_key+"States/"+c.state_id+"/acts/"+g.id}).success(function(h){a.toasterInfo("成功！","已取消关联！")})}}}]);