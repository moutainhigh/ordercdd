"use strict";app.controller("menuConfigModuleController",["$rootScope","$scope","$http","$stateParams","$state",function(a,b,e,d,c){b.select_branch=function(f){c.go("menuConfig.edit",f)};console.log("menuConfigModuleController")}]);app.controller("menuConfigFormController",["$rootScope","$scope","$http","$stateParams","entity",function(a,c,e,d,b){c.id=d.id;c.ownRoles=[];c.allRoles=[];c.menu={};c.entities=[];c.selectEntity=null;c.entityWorkflows=null;c.selectWorkflow=null;c.parentMenu=null;c.entityIsSelected=false;angular.forEach(a.allEntitiesInfo,function(g,f){c.entities.push({label:f})});c.changeEntity=function(f){if(f){c.entityIsSelected=true;b.getList("rest/"+f.label+"Workflows").then(function(g){c.entityWorkflows=g._embeddedItems;if(c.menu._links){angular.forEach(c.entityWorkflows,function(i,h){if(c.menu.workflowId===i.id){c.selectWorkflow=i}})}})}};if(c.id){b.getDetail("rest/menus/"+c.id,["parent","visibleRoles"]).then(function(f){c.menu=f;if(JSON.stringify(c.menu.parent)!=="{}"&&angular.isObject(c.menu.parent)){c.parentMenu=b.getSelectedMyOwn(a.menus,c.menu.parent)}angular.forEach(c.entities,function(h,g){if(c.menu.entityKey===h.label){c.selectEntity=h;c.changeEntity(c.selectEntity)}});c.ownRoles=c.menu.visibleRoles._embeddedItems;c.getAllRoles(c.ownRoles)})}c.getAllRoles=function(f){b.getList("rest/roles?size=10000").then(function(g){c.allRoles=g._embeddedItems;angular.forEach(c.allRoles,function(i,h){i.isSelected=false;angular.forEach(f,function(k,j){if(k.id===i.id){i.isSelected=true}})})})};c.save=function(){delete c.menu.visibleRoles;c.menu.parent=c.parentMenu?"rest/menus/"+c.parentMenu.id:null;c.menu.level=c.menu.level?Number(c.menu.level):null;c.menu.entityKey=c.selectEntity?c.selectEntity.label:null;c.menu.workflowId=c.selectWorkflow?c.selectWorkflow.id:null;if(c.menu._links){e({url:c.menu._links.self.href,method:"PATCH",data:c.menu}).success(function(f){a.toasterSuccess("成功！","修改成功！");location.reload(true)})}else{e.post("rest/menus",c.menu).success(function(f){e({method:"PATCH",url:"rest/menus/"+f.id+"/visibleRoles",data:"rest/roles/1",headers:{"Content-Type":"text/uri-list"}}).success(function(g){a.toasterSuccess("成功！","新建成功！");location.reload(true)})})}};c.changeMenuRole=function(f){if(f.isSelected){e({method:"PATCH",url:c.menu._links.visibleRoles.href,data:f._links.self.href,headers:{"Content-Type":"text/uri-list"}}).success(function(g){a.toasterSuccess("成功！","关联成功！")})}else{e({method:"DELETE",url:c.menu._links.visibleRoles.href+"/"+f.id}).success(function(g){a.toasterInfo("成功！","已取消关联！")})}}}]);