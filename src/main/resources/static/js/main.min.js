"use strict";app.controller("AppCtrl",["$scope","$http","$translate","$localStorage","$window","$rootScope","$state","$filter","entity",function(k,g,b,i,c,h,a,f,e){h.updateUser={};k.globalListHashJump=function(){var l=window.sessionStorage.getItem("globalListType");var m=JSON.parse(window.sessionStorage.getItem("globalListParams"));a.go(l,m,{reload:true})};h.myinfo=angular.copy(window.myinfo);h.updateUser.nickname=h.myinfo.nickname;h.updateUser.sex=h.myinfo.sex;h.updateUser.country=h.myinfo.country;h.updateUser.province=h.myinfo.province;h.updateUser.city=h.myinfo.city;h.updateUser.headimgurl=h.myinfo.headimgurl;e.getDetail("rest/roles/"+h.myinfo.role.id).then(function(l){h.menus=l.visibleMenuTree});g.get("getEntityInfo").success(function(l){h.allEntitiesInfo=l;console.log(h.allEntitiesInfo)});k.oldPwd=null;k.newPwd=null;k.confirmPwd=null;k.resetPassword=function(){g({method:"PATCH",url:"/rest/users/"+h.myinfo.id,data:{act:"Modifypassword",password:k.oldPwd,newPassword:k.confirmPwd}}).success(function(l){h.toasterSuccess("成功！","修改密码成功！");$("#reset_password_modal").modal("hide");window.location.href="/logout"})};k.updateUserInfo=function(){h.updateUser.act="update";g({method:"PATCH",url:"/rest/users/"+h.myinfo.id,data:h.updateUser}).success(function(l){h.toasterSuccess("成功！","修改用户信息成功！");$("#user_update_modal").modal("hide");window.location.reload(true)})};k.updateHeadimg=function(){var l=new FormData();var m=$("#headimgurl_update_input")[0].files[0];if(m){l.append("fileType","image");l.append("file",m);g({method:"POST",url:"fileUpload",data:l,headers:{"Content-type":undefined}}).success(function(n){g({method:"PATCH",url:"/rest/users/"+h.myinfo.id,data:{act:"update",headimgurl:"http://files.xiaojinpingtai.com/"+n.result.newFileName}}).success(function(o){h.toasterSuccess("成功！","修改用户头像成功！");$("#headimg_update_modal").modal("hide");window.location.reload(true)})})}};h.toasterSuccess=function(m,l){toastr.success(l,m)};h.toasterError=function(m,l){toastr.error(l,m)};h.toasterWarning=function(m,l){toastr.warning(l,m)};h.toasterInfo=function(m,l){toastr.info(l,m)};h.sweetConfirm=function(l){swal({title:l.title,text:l.text,type:l.type,showCancelButton:true,confirmButtonColor:"#F05050",cancelButtonText:"不，让我想想",confirmButtonText:"是，我想好了",closeOnConfirm:true},function(){l.callback()})};h.setPaginator=function(l,n,o){var m={bootstrapMajorVersion:3,currentPage:n.current_page+1,totalPages:n.total_page,tooltipTitles:function(p,q,r){switch(p){case"next":return"下一页";case"last":return"末页";case"page":return"第"+q+"页"}},itemTexts:function(p,q,r){switch(p){case"first":return"首页";case"prev":return"上一页";case"next":return"下一页";case"last":return"末页";case"page":return q}},onPageChanged:function(q,r,p){o(p-1)}};$(l).bootstrapPaginator(m)};h.unReadNumber=0;h.notice=new SockJS(window.location.origin+"/notice");h.notice.onopen=function(){e.getUnReadNotice()};h.notice.onmessage=function(l){h.toasterInfo("消息提示！","您有一条新的消息！");e.getUnReadNotice();h.getNoticeList(0)};h.notice.onclose=function(l){};h.noticeForms={};h.noticeSearchForms={};h.noticeForms.size="10";h.noticeForms.sort="id,desc";h.noticePageList={size:0,total_elements:0,current_page:0,num_page:1,total_page:1};h.noticeList=[];h.getNoticeList=function(l){h.noticeList=[];h.noticeForms.page=l;g.get("/notice/search",{params:h.noticeForms}).then(function(m){h.noticeList=m.data.content;if(h.noticeList.length>0){h.noticeList=h.noticeList.sort(function(o,n){return new Date(n.noticeInfo.createdAt)-new Date(o.noticeInfo.createdAt)});h.noticePageList={size:m.data.size,total_elements:m.data.totalElements,current_page:m.data.number,num_page:m.data.totalPages,total_page:m.data.totalPages}}else{h.noticePageList={size:0,total_elements:0,current_page:0,num_page:1,total_page:1}}h.setPaginator("#notice_list_paginator",h.noticePageList,h.getNoticeList)})};h.noticeSearchSubmit=function(){if(h.noticeForms.isRead===""){delete h.noticeForms.isRead}h.noticeForms=Object.assign(h.noticeSearchForms,h.noticeForms);h.getNoticeList(0)};h.noticeClearSearch=function(){h.noticeForms={};h.noticeSearchForms={};h.noticeForms.size="10";h.noticeForms.sort="id,desc";h.getNoticeList(0)};h.readNotice=function(l,n,m){g({method:"PATCH",url:"/rest/notices/"+l,data:{read:n}}).success(function(o){e.getUnReadNotice();if(m){h.getNoticeList(0)}})};h.toNoticeDetail=function(l,n){var m=f("formatNoticeEntity")(n);h.readNotice(l,true,false);a.go(m.entityType+".home.profile.info",{id:m.entityId,workflow_id:m.workflowId,entity_key:m.entityName},{reload:true})};h.global_configs={isEnabled:[{key:0,name:"不启用"},{key:1,name:"启用"}],product_types:{credit_load:"信用贷",mortgage_load:"抵押",pledge_load:"质押"},repayment_types:{dengerbenxi:"等额本息",dengerbenjin:"等额本金",xianxihouben:"先息后本"},customer_types:{personal:"个人",enterprise:"企业"},time_units:{day:"天",week:"周",month:"月"}};var d=!!navigator.userAgent.match(/MSIE/i);if(d){angular.element(c.document.body).addClass("ie")}if(j(c)){angular.element(c.document.body).addClass("smart")}k.app={name:"小金平台",version:"1.0.0",color:{primary:"#7266ba",info:"#23b7e5",success:"#27c24c",warning:"#fad733",danger:"#f05050",light:"#e8eff0",dark:"#3a3f51",black:"#1c2b36"},settings:{themeID:13,navbarHeaderColor:"bg-dark",navbarCollapseColor:"bg-white-only",asideColor:"bg-dark",headerFixe:true,asideFixed:true,asideFolded:false,asideDock:false,container:false}};if(angular.isDefined(i.settings)){k.app.settings=i.settings}else{i.settings=k.app.settings}k.$watch("app.settings",function(){if(k.app.settings.asideDock&&k.app.settings.asideFixed){k.app.settings.headerFixed=true}k.app.settings.container?angular.element("html").addClass("bg"):angular.element("html").removeClass("bg");i.settings=k.app.settings},true);k.lang={isopen:false};b.use("getEntityInfo");function j(m){var l=m.navigator["userAgent"]||m.navigator["vendor"]||m.opera;return(/iPhone|iPod|iPad|Silk|Android|BlackBerry|Opera Mini|IEMobile/).test(l)}}]).run(["$rootScope","$state","$stateParams","$templateCache","$log",function(b,c,d,a,e){b.$on("$stateChangeSuccess",function(i,f,h,j,g){if(f.name==="workflowEntity.list"||f.name==="auditEntity.list"){window.sessionStorage.setItem("globalListType",f.name);window.sessionStorage.setItem("globalListParams",JSON.stringify(h))}})}]);