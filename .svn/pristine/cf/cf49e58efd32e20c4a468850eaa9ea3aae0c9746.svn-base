"use strict";app.controller("AppCtrl",["$scope","$http","$translate","$localStorage","$window","$rootScope","$state","$websocket","entity",function(k,g,b,i,c,h,a,d,f){h.updateUser={};h.selectMessage=function(l){$(l.delegateTarget).parent().siblings().find("li").removeClass("active");$("#message_container").css("display","block");$("#common_container").css("display","none");$("#message_un_read").css("display","none")};h.unSelectMessage=function(){$("#message_container").css("display","none");$("#common_container").css("display","block")};k.globalListHashJump=function(){var l=window.sessionStorage.getItem("globalListType");var m=JSON.parse(window.sessionStorage.getItem("globalListParams"));a.go(l,m,{reload:true})};h.myinfo=angular.copy(window.myinfo);h.updateUser.nickname=h.myinfo.nickname;h.updateUser.sex=h.myinfo.sex;h.updateUser.country=h.myinfo.country;h.updateUser.province=h.myinfo.province;h.updateUser.city=h.myinfo.city;h.updateUser.headimgurl=h.myinfo.headimgurl;loginAndInitIm(h.myinfo);f.getDetail("rest/roles/"+h.myinfo.role.id).then(function(l){h.menus=l.visibleMenuTree});g.get("getEntityInfo").success(function(l){h.allEntitiesInfo=l;console.log(h.allEntitiesInfo)});k.oldPwd=null;k.newPwd=null;k.confirmPwd=null;k.resetPassword=function(){g({method:"PATCH",url:h.myinfo._links.self.href,data:{act:"Modifypassword",password:k.oldPwd,newPassword:k.confirmPwd}}).success(function(l){h.toasterSuccess("成功！","修改密码成功！");$("#reset_password_modal").modal("hide");window.location.href="/logout"})};k.updateUserInfo=function(){h.updateUser.act="update";g({method:"PATCH",url:h.myinfo._links.self.href,data:h.updateUser}).success(function(l){h.toasterSuccess("成功！","修改用户信息成功！");$("#user_update_modal").modal("hide");window.location.reload(true)})};k.updateHeadimg=function(){var l=new FormData();var m=$("#headimgurl_update_input")[0].files[0];if(m){l.append("fileType","image");l.append("file",m);g({method:"POST",url:"fileUpload",data:l,headers:{"Content-type":undefined}}).success(function(n){g({method:"PATCH",url:h.myinfo._links.self.href,data:{act:"update",headimgurl:"http://files.xiaojinpingtai.com/"+n.result.newFileName}}).success(function(o){h.toasterSuccess("成功！","修改用户头像成功！");$("#headimg_update_modal").modal("hide");window.location.reload(true)})})}};h.toasterSuccess=function(m,l){toastr.success(l,m)};h.toasterError=function(m,l){toastr.error(l,m)};h.toasterWarning=function(m,l){toastr.warning(l,m)};h.toasterInfo=function(m,l){toastr.info(l,m)};h.sweetConfirm=function(l){swal({title:l.title,text:l.text,type:l.type,showCancelButton:true,confirmButtonColor:"#F05050",cancelButtonText:"不，让我想想",confirmButtonText:"是，我想好了",closeOnConfirm:true},function(){l.callback()})};h.setPaginator=function(l,n,o){var m={bootstrapMajorVersion:3,currentPage:n.current_page+1,totalPages:n.total_page,tooltipTitles:function(p,q,r){switch(p){case"next":return"下一页";case"last":return"末页";case"page":return"第"+q+"页"}},itemTexts:function(p,q,r){switch(p){case"first":return"首页";case"prev":return"上一页";case"next":return"下一页";case"last":return"末页";case"page":return q}},onPageChanged:function(q,r,p){o(p-1)}};$(l).bootstrapPaginator(m)};h.unReadNumber=0;h.global_configs={isEnabled:[{key:0,name:"不启用"},{key:1,name:"启用"}],product_types:{credit_load:"信用贷",mortgage_load:"抵押",pledge_load:"质押"},repayment_types:{dengerbenxi:"等额本息",dengerbenjin:"等额本金",xianxihouben:"先息后本"},customer_types:{personal:"个人",enterprise:"企业"},time_units:{day:"天",week:"周",month:"月"}};var e=!!navigator.userAgent.match(/MSIE/i);if(e){angular.element(c.document.body).addClass("ie")}if(j(c)){angular.element(c.document.body).addClass("smart")}k.app={name:"小金平台",version:"1.0.0",color:{primary:"#7266ba",info:"#23b7e5",success:"#27c24c",warning:"#fad733",danger:"#f05050",light:"#e8eff0",dark:"#3a3f51",black:"#1c2b36"},settings:{themeID:13,navbarHeaderColor:"bg-dark",navbarCollapseColor:"bg-white-only",asideColor:"bg-dark",headerFixe:true,asideFixed:true,asideFolded:false,asideDock:false,container:false}};if(angular.isDefined(i.settings)){k.app.settings=i.settings}else{i.settings=k.app.settings}k.$watch("app.settings",function(){if(k.app.settings.asideDock&&k.app.settings.asideFixed){k.app.settings.headerFixed=true}k.app.settings.container?angular.element("html").addClass("bg"):angular.element("html").removeClass("bg");i.settings=k.app.settings},true);k.lang={isopen:false};b.use("getEntityInfo");function j(m){var l=m.navigator["userAgent"]||m.navigator["vendor"]||m.opera;return(/iPhone|iPod|iPad|Silk|Android|BlackBerry|Opera Mini|IEMobile/).test(l)}}]).run(["$rootScope","$state","$stateParams","$templateCache","$log",function(b,c,d,a,e){b.$on("$stateChangeSuccess",function(i,f,h,j,g){if(f.name==="workflowEntity.list"||f.name==="auditEntity.list"){window.sessionStorage.setItem("globalListType",f.name);window.sessionStorage.setItem("globalListParams",JSON.stringify(h))}})}]);