"use strict";app.controller("AppCtrl",["$scope","$http","$translate","$localStorage","$window","$rootScope","$state","entity",function(j,f,b,h,c,g,a,e){g.myinfo={};g.updateUser={};g.onMessage=window.onMessage;g.distEntityId=window.distEntityId;g.selectMessage=function(k){$(k.delegateTarget).parent().siblings().find("li").removeClass("active");$("#message_container").css("display","block");$("#common_container").css("display","none");$("#message_un_read").css("display","none")};g.unSelectMessage=function(){$("#message_container").css("display","none");$("#common_container").css("display","block")};g.myinfo=angular.copy(window.myinfo);g.updateUser.nickname=g.myinfo.nickname;g.updateUser.sex=g.myinfo.sex;g.updateUser.country=g.myinfo.country;g.updateUser.province=g.myinfo.province;g.updateUser.city=g.myinfo.city;g.updateUser.headimgurl=g.myinfo.headimgurl;loginAndInitIm(g.myinfo);e.getDetail("rest/roles/"+g.myinfo.role.id).then(function(k){g.menus=k.visibleMenuTree});f.get("getEntityInfo").success(function(k){g.allEntitiesInfo=k;console.log(g.allEntitiesInfo)});g.sessions={};g.groups={};g.friends={};g.menus=[];g.notices={};g.unReadNumber=0;j.distributionSave=function(l,k){if(l){f({method:"PATCH",url:"/rest/orderwdsjshes/"+k,data:{act:"distribution",notice:l.openid,serviceId:l.id}}).success(function(m){$("#global_distribution").modal("hide")})}else{g.toasterWarning("注意","请选择一个业务员！")}};j.userList={};j.getLogList=function(){e.getList("rest/orderwdsjshLogs/search/latestNoticeUser?act_id=8").then(function(k){if(k._embeddedItems){angular.forEach(k._embeddedItems,function(m,l){j.userList[m.id]=m})}})};j.getLogList();j.getList=function(){f.get("/linkman").success(function(k){angular.forEach(k,function(m,l){j.userList[m.id]=m})})};j.distributionSelect="0";j.distributionShow=function(k){if(k==="0"){j.userList={};j.getLogList()}else{j.userList={};j.getList()}};j.oldPwd=null;j.newPwd=null;j.confirmPwd=null;j.resetPassword=function(){f({method:"PATCH",url:g.myinfo._links.self.href,data:{act:"Modifypassword",password:j.oldPwd,newPassword:j.confirmPwd}}).success(function(k){g.toasterSuccess("成功！","修改密码成功！");$("#reset_password_modal").modal("hide");window.location.href="/logout"})};j.updateUserInfo=function(){g.updateUser.act="update";f({method:"PATCH",url:g.myinfo._links.self.href,data:g.updateUser}).success(function(k){g.toasterSuccess("成功！","修改用户信息成功！");$("#user_update_modal").modal("hide");window.location.reload(true)})};j.updateHeadimg=function(){var k=new FormData();var l=$("#headimgurl_update_input")[0].files[0];if(l){k.append("fileType","image");k.append("file",l);f({method:"POST",url:"fileUpload",data:k,headers:{"Content-type":undefined}}).success(function(m){f({method:"PATCH",url:g.myinfo._links.self.href,data:{act:"update",headimgurl:"http://files.xiaojinpingtai.com/"+m.result.newFileName}}).success(function(n){g.toasterSuccess("成功！","修改用户头像成功！");$("#headimg_update_modal").modal("hide");window.location.reload(true)})})}};g.toasterSuccess=function(l,k){toastr.success(k,l)};g.toasterError=function(l,k){toastr.error(k,l)};g.toasterWarning=function(l,k){toastr.warning(k,l)};g.toasterInfo=function(l,k){toastr.info(k,l)};g.sweetConfirm=function(k){swal({title:k.title,text:k.text,type:k.type,showCancelButton:true,confirmButtonColor:"#F05050",cancelButtonText:"不，让我想想",confirmButtonText:"是，我想好了",closeOnConfirm:true},function(){k.callback()})};g.setPaginator=function(k,m,n){var l={bootstrapMajorVersion:3,currentPage:m.current_page+1,totalPages:m.total_page,tooltipTitles:function(o,p,q){switch(o){case"next":return"下一页";case"last":return"末页";case"page":return"第"+p+"页"}},itemTexts:function(o,p,q){switch(o){case"first":return"首页";case"prev":return"上一页";case"next":return"下一页";case"last":return"末页";case"page":return p}},onPageChanged:function(p,q,o){n(o-1)}};$(k).bootstrapPaginator(l)};g.global_configs={isEnabled:[{key:0,name:"不启用"},{key:1,name:"启用"}],product_types:{credit_load:"信用贷",mortgage_load:"抵押",pledge_load:"质押"},repayment_types:{dengerbenxi:"等额本息",dengerbenjin:"等额本金",xianxihouben:"先息后本"},customer_types:{personal:"个人",enterprise:"企业"},time_units:{day:"天",week:"周",month:"月"}};var d=!!navigator.userAgent.match(/MSIE/i);if(d){angular.element(c.document.body).addClass("ie")}if(i(c)){angular.element(c.document.body).addClass("smart")}j.app={name:"小金平台",version:"1.0.0",color:{primary:"#7266ba",info:"#23b7e5",success:"#27c24c",warning:"#fad733",danger:"#f05050",light:"#e8eff0",dark:"#3a3f51",black:"#1c2b36"},settings:{themeID:13,navbarHeaderColor:"bg-dark",navbarCollapseColor:"bg-white-only",asideColor:"bg-dark",headerFixe:true,asideFixed:true,asideFolded:false,asideDock:false,container:false}};if(angular.isDefined(h.settings)){j.app.settings=h.settings}else{h.settings=j.app.settings}j.$watch("app.settings",function(){if(j.app.settings.asideDock&&j.app.settings.asideFixed){j.app.settings.headerFixed=true}j.app.settings.container?angular.element("html").addClass("bg"):angular.element("html").removeClass("bg");h.settings=j.app.settings},true);j.lang={isopen:false};b.use("getEntityInfo");function i(l){var k=l.navigator["userAgent"]||l.navigator["vendor"]||l.opera;return(/iPhone|iPod|iPad|Silk|Android|BlackBerry|Opera Mini|IEMobile/).test(k)}}]).run(["$rootScope","$state","$stateParams","$templateCache","$log",function(b,c,d,a,e){b.$on("$stateChangeSuccess",function(i,f,h,j,g){})}]);