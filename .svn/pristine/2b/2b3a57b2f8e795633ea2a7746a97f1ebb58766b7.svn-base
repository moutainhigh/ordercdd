(function(){angular.module("spring-data-rest",["ngResource"]);angular.module("spring-data-rest").provider("SpringDataRestAdapter",function(){var g={linksKey:"_links",linksHrefKey:"href",linksSelfLinkName:"self",embeddedKey:"_embedded",embeddedNewKey:"_embeddedItems",embeddedNamedResources:false,resourcesKey:"_resources",resourcesFunction:undefined,fetchFunction:undefined,fetchAllKey:"_allLinks"};return{config:function(h){if(typeof h!=="undefined"){if(!angular.isObject(h)){throw new Error("The given configuration '"+h+"' is not an object.")}if(h.resourcesFunction!=undefined&&typeof(h.resourcesFunction)!="function"){throw new Error("The given resource function '"+h.resourcesFunction+"' is not of type function.")}if(h.fetchFunction!=undefined&&typeof(h.fetchFunction)!="function"){throw new Error("The given fetch function '"+h.fetchFunction+"' is not of type function.")}g=d(g,h)}return g},$get:["$injector",function(j){var k={};function l(o,p,q,n){if(g.resourcesFunction==undefined){return j.get("$resource")(o,p,q,n)}else{return g.resourcesFunction(o,p,q,n)}}function i(p,q,s,n,o){if(g.fetchFunction==undefined){var r=[];r.push(j.get("$http").get(p).then(function(t){if(o){return m(t.data,n,true).then(function(u){s[q]=u})}else{return m(t.data).then(function(u){s[q]=u})}},function(t){if(t.status!=404){return j.get("$q").reject(t)}}));return j.get("$q").all(r)}else{return g.fetchFunction(p,q,s,n,o)}}var m=function h(s,p,q){return j.get("$q").when(s).then(function(x){var y=function(E,G,D,I){var B=this[g.linksKey];var H=G;var A="";if(n(E)){var F=r(E);E=F[0];A=F[1]}if(angular.isObject(E)){if(!E.name){throw new Error("The provided resource object must contain a name property.")}var C=E.parameters;if(G&&angular.isObject(G)){if(C&&angular.isObject(C)){H=angular.extend(angular.copy(G),angular.copy(C))}else{H=angular.copy(G)}}else{if(C&&angular.isObject(C)){H=angular.copy(C)}}angular.forEach(H,function(K,J){if(K===""){delete H[J]}});return l(o(x,E.name),H,D,I)}else{if(E in B){return l(o(x,E)+A,H,D,I)}}var z=[];angular.forEach(B,function(K,J){if(K.templated){var L=f(K[g.linksHrefKey]);z.push({name:J,parameters:L})}else{z.push({name:J})}});return z};if(x&&x.data){x=x.data}if(!angular.isObject(x)||x instanceof Array){return{}}if(p&&!(p instanceof Array||typeof p==="string")){return j.get("$q").reject("Given fetch links '"+p+"' is not of type array or string.")}var v=undefined;var w=[];if(g.linksKey in x){var u={};u[g.resourcesKey]=y;v=angular.extend(angular.copy(x),u);if(p!=undefined){var t=x[g.linksKey][g.linksSelfLinkName][g.linksHrefKey];if(!k[t]){k[t]=[]}angular.forEach(x[g.linksKey],function(z,A){if(A!=g.linksSelfLinkName){if(k[t].indexOf(A)<0&&(p==g.fetchAllKey||(typeof p==="string"&&A==p)||(p instanceof Array&&p.indexOf(A)>=0))){w.push(i(o(x,A),A,v,p,q));k[t].push(A)}}})}}if(g.embeddedKey in x){if(!v){v=angular.copy(x)}v=c(v,g.embeddedKey,g.embeddedNewKey,g.embeddedNamedResources);angular.forEach(v[g.embeddedNewKey],function(A,z){if(A instanceof Array&&A.length>0){var B=[];var C;angular.forEach(A,function(D,E){if(angular.isObject(D)){C=h({data:D},p,q).then(function(F){B[E]=F});w.push(C)}else{B[E]=D}});if(C){C.then(function(){v[g.embeddedNewKey][z]=B})}}else{if(angular.isObject(A)){w.push(h({data:A},p,q).then(function(D){v[g.embeddedNewKey][z]=D}))}}})}return j.get("$q").all(w).then(function(){return v?v:x})});function o(v,u){var t=a(v[g.linksKey][u][g.linksHrefKey],u,g.linksHrefKey);return b(t,v[g.linksKey][u].templated)}function n(t){return typeof t=="string"&&t.indexOf("/")>0}function r(t){if(n(t)){var u=t.indexOf("/");return[t.substr(0,u),t.substr(u,t.length)]}}};return{process:function(p,n,o){k={};return m(p,n,o)}}}]}});angular.module("spring-data-rest").provider("SpringDataRestInterceptor",["$httpProvider","SpringDataRestAdapterProvider",function(g){return{apply:function(){g.interceptors.push("SpringDataRestInterceptor")},$get:["SpringDataRestAdapter","$q",function(i,h){return{response:function(j){if(!angular.isObject(j.data)){return j}return i.process(j.data).then(function(k){j.data=k;return j})}}}],initInterceptors:function(){g.interceptors.push(function(){return{response:function(h){if(h.data.ActionStatus&&h.data.ActionStatus==="FAIL"){toastr.error("请求失败！"+h.data.ErrorInfo,h.data.ErrorCode)}else{return h}},responseError:function(h){if(h.status===500){toastr.error("请求失败！"+h.data.message,(h.data.error?h.data.error:""))}else{toastr.error("您的网络出了点问题，请联系管理员","请求失败！")}}}})}}}]);function d(g){angular.forEach(arguments,function(h){if(h!==g){angular.forEach(h,function(j,i){if(g[i]&&g[i].constructor&&g[i].constructor===Object){d(g[i],j)}else{g[i]=j}})}});return angular.copy(g)}function c(j,l,i,m){var g=j[l];if(g){var h={};h[i]={};if(m===true){angular.forEach(Object.keys(g),function(n){h[i][n]=g[n]})}else{var k=Object.keys(g)[0];h[i]=g[k]}j=angular.extend(j,h);delete j[l]}return j}function b(g,h){if(h){g=e(g)}return g}function a(g,h,i){if(g==undefined||!g){throw new Error("The provided resource name '"+h+"' has no valid URL in the '"+i+"' property.")}return g}function e(g){return g.replace(/{.*}/g,"")}function f(h){var g={};var i=/{\?(.*)}/g;var j=i.exec(h)[1].split(",");angular.forEach(j,function(k){g[k]=""});return g}})();